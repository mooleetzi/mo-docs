## export to sql功能说明

比如mysqldump，MO需要一个工具或者一个语句，将数据库或者表导出成一个同时具有DDL和DML的SQL文件。然后用户可以运行导出的 SQL 文件来重新创建这些对象。

### 1、基本语法

```
modump database databaseName[ tables tableNameList] into 'filePath' [max_file_size size];
``` 

### 2、参数说明

* database databaseName：指定导出的数据库
* table tableNameList：指定导出的表,多个表用逗号分隔;如果不指定，则导出整个数据库
* filePath：导出文件的路径
* max_file_size size：指定导出文件的最大大小，单位为B,最小为1MB;如果超出指定大小，则会自动分割成多个文件

### 3、实现原理

#### 3.1 获取待导出元素的ddl

目前使用`show create table`语句获取表的ddl，使用`show create database`语句获取数据库的ddl。
后续会修改为从`mo_catalog`数据库中查询ddl。

#### 3.2 获取数据生成insert语句

从engine.table.NewReader()中获取数据，然后生成insert语句。

#### 3.3 将ddl和insert语句写入文件

### 4、使用示例

```
DROP DATABASE IF EXISTS `t`;
CREATE DATABASE `t`;
USE `t`;
create table t1(c1 int primary key auto_increment,c2 tinyint not null default 4,c3 smallint,c4 bigint,c5 tinyint unsigned,c6 smallint unsigned,c7 int unsigned,c8 bigint unsigned,c9 float,c10 double,c11 date,c12 datetime,c13 timestamp on update current_timestamp,c14 char,c15 varchar,c16 json,c17 decimal,c18 text,c19 blob,c20 uuid);
insert into t1 values(1,1,1,1,1,1,1,1,1,1,'2019-01-01','2019-01-01 00:00:00','2019-01-01 00:00:00','a','a','{"a":1}','1212.1212','a','aza','00000000-0000-0000-0000-000000000000');
select * from t1;
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
| c1 | c2 | c3 | c4 | c5 | c6 | c7 | c8 | c9 | c10 | c11        | c12                 | c13                 | c14 | c15 | c16    | c17      | c18 | c19 | c20                                  |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
|  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 | 2019-01-01 | 2019-01-01 00:00:00 | 2019-01-01 00:00:00 | a  | a  | {"a":1} | 1212.1212 | a  | aza | 00000000-0000-0000-0000-000000000000 |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
1 row in set (0.00 sec)



modump database t into 'a.sql';
drop database t;
source a.sql;
select * from t1;
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
| c1 | c2 | c3 | c4 | c5 | c6 | c7 | c8 | c9 | c10 | c11        | c12                 | c13                 | c14 | c15 | c16    | c17      | c18 | c19 | c20                                  |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
|  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 | 2019-01-01 | 2019-01-01 00:00:00 | 2019-01-01 00:00:00 | a  | a  | {"a":1} | 1212.1212 | a  | aza | 00000000-0000-0000-0000-000000000000 |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
1 row in set (0.00 sec)



create table t2(a int);
insert into t2 values(22);
select * from t2;
modump database t into 'b.sql';
drop database t;
source b.sql;
select * from t1;
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
| c1 | c2 | c3 | c4 | c5 | c6 | c7 | c8 | c9 | c10 | c11        | c12                 | c13                 | c14 | c15 | c16    | c17      | c18 | c19 | c20                                  |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
|  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 | 2019-01-01 | 2019-01-01 00:00:00 | 2019-01-01 00:00:00 | a  | a  | {"a":1} | 1212.1212 | a  | aza | 00000000-0000-0000-0000-000000000000 |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
1 row in set (0.00 sec)
select * from t2;
+----+
| a  |
+----+
| 22 |
+----+
1 row in set (0.00 sec)



modump database t tables t1 into 'c.sql';
drop table t1;
source c.sql;
select * from t1;
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
| c1 | c2 | c3 | c4 | c5 | c6 | c7 | c8 | c9 | c10 | c11        | c12                 | c13                 | c14 | c15 | c16    | c17      | c18 | c19 | c20                                  |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
|  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 | 2019-01-01 | 2019-01-01 00:00:00 | 2019-01-01 00:00:00 | a  | a  | {"a":1} | 1212.1212 | a  | aza | 00000000-0000-0000-0000-000000000000 |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
1 row in set (0.00 sec)



modump database t tables t1,t2 into 'd.sql';
drop table t1;
drop table t2;
source d.sql;
select * from t1;
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
| c1 | c2 | c3 | c4 | c5 | c6 | c7 | c8 | c9 | c10 | c11        | c12                 | c13                 | c14 | c15 | c16    | c17      | c18 | c19 | c20                                  |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
|  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 |  1 | 2019-01-01 | 2019-01-01 00:00:00 | 2019-01-01 00:00:00 | a  | a  | {"a":1} | 1212.1212 | a  | aza | 00000000-0000-0000-0000-000000000000 |
+----+----+----+----+----+----+----+----+----+----+------------+---------------------+---------------------+----+----+--------+----------+----+----+--------------------------------------+
1 row in set (0.00 sec)
select * from t2;
+----+
| a  |
+----+
| 22 |
+----+
1 row in set (0.00 sec)


create view v1 as select * from t2;
modump database t into 'e.sql';
drop database t;
source e.sql;
select * from v1;
+----+
| a  |
+----+
| 22 |
+----+
1 row in set (0.00 sec)
```